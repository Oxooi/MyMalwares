import socket
import time
import os

IPSERVEUR = '192.168.1.1'
PORT = 1337

client = socket.socket()
client.connect((IPSERVEUR, PORT))
print(f"Connexion vers {IPSERVEUR} : " + str(PORT) + " réussie.")


def sendResponse(msg):
    msg = str(msg)
    msg = msg.encode('utf-8')
    n = client.send(msg)
    if n != len(msg):
        print('Error while sending.')
    return


while True:
    data = client.recv(1024)
    data = data.decode('utf-8')
    arr_data = data.split()
    if not data:
        print('Error while recieve')
        break
    else:
        match arr_data[0]:

            case 'close':  # Close the connection
                client.close()
                sendResponse("Client died")
                break

            case 'mkdir':  # Create a directory
                if len(arr_data) < 2:
                    sendResponse("Insufficient data")
                name = arr_data[1]
                if len(arr_data) >= 3:
                    try:
                        nbr = int(arr_data[2])
                    except ValueError:
                        sendResponse("Invalid number")
                else:
                    nbr = 1
                if nbr == 1 or nbr is None:
                    try:
                        os.mkdir(name)
                    except FileExistsError:
                        print('File already exists.')
                else:
                    for i in range(nbr):
                        try:
                            os.mkdir(name + str(i))
                        except FileExistsError:
                            print('File already exists.')
                sendResponse("Ok")

            case 'touch':
                if len(arr_data) < 2:
                    sendResponse("Insufficient data")
                name = arr_data[1]
                if len(arr_data) >= 3:
                    try:
                        nbr = int(arr_data[2])
                    except ValueError:
                        sendResponse("Invalid number")
                else:
                    nbr = 1
                if nbr == 1 or nbr is None:
                    try:
                        open(name, 'x')
                    except FileExistsError:
                        print('File already exists.')
                else:
                    for i in range(nbr):
                        try:
                            open(name + str(i), 'x')
                        except FileExistsError:
                            print('File already exists.')
                sendResponse("Ok")

            case 'ls':  # List all the directories
                msg = os.listdir()
                sendResponse(msg)

            case 'cd':
                dir = arr_data[1]
                os.chdir(dir)
                sendResponse(f"Directory changed to -> {dir}")

            case _:  # Default case
                pass  # Ignore the instruction
                sendResponse("Cmd ignored")

    time.sleep(0.1)

print('Déconnexion.')
client.close()
