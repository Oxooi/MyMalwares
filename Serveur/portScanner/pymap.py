#!/usr/bin/env python
# -*- coding:UTF-8 -*-

import socket, errno

ports=[21,22,23,25,53,80,110,143,443,993,995,1723,3306,3389,5900,8080]
portouvert=[]
portferme=[]
portfiltre=[]

def scanport(ip):
    ip = input("Entrez l'adresse IP: ")

    i = 0
    j = 0
    while i < 10:
        #On crée le socket
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        retourscan = s.connect_ex((ip, ports[i]))
        #Pour la connexion réussie
        if retourscan == 0:
            #On ferme la connexion
            s.shutdown(socket.SHUT_RDWR)
            #On ferme le socket
            s.close()
            #On ajoute le port à la liste des ports ouverts
            portouvert.append(ports[i])
        #Pour la connexion refusée
        else:
            #erreur de connexion - port fermé
            if errno.errorcode[retourscan] == "ECONNREFUSED":
                #On ajoute le port à la liste des ports fermés
                portferme.append(ports[i])
            #Erreur de connexion - port filtré
            elif errno.errorcode[retourscan] == "EHOSTUNREACH":
                #On ajoute le port à la liste des ports filtrés
                portfiltre.append(ports[i])
            #Erreur de connexion - hote introuvable
            else : 
                print("Erreur de connexion - hote introuvable")
                j = 1
                #On sort de la boucle
                i = 10
        i = i + 1
#Si j = 1 on ferme le programme
if j == 1:
    print("Fin du programme")
#On affiche soit les ports ouverts, soit les ports fermés, soit les ports filtrés
else:
    if len(portouvert) != 0:
        print("Les ports ouverts sont: ", portouvert)
    elif len(portferme) != 0:
        print("Les ports fermés sont: ", portferme)
    elif len(portfiltre) != 0:
        print("Les ports filtrés sont: ", portfiltre)
    else:
        print("Aucun port n'est ouvert, fermé ou filtré")
        