import socket
import os
import sys

host = '192.168.1.48'
port = 1337
counter = 0

# Create a socket object
mySocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Connect to the server
try:
    mySocket.bind((host, port))
except socket.error:
    print('La liaison du socket à l\'adresse choisie a échoué.')
    sys.exit()

while 1:
    # Wait for a connection
    print('En attente d\'une connexion')
    mySocket.listen(2)

    # Establish a connection
    connection, address = mySocket.accept()
    counter += 1
    print('Client connecté n°' + str(counter) + ', adresse IP ' +
          address[0] + ', port ' + str(address[1]))

    # Dialogue avec le client
    msgServeur = "Vous êtes connecté au serveur. Envoyez des messages. Pour quitter, tapez 'fin'."
    connection.send(msgServeur.encode("Utf8"))
    msgClient = connection.recv(1024).decode("Utf8")
    while 1:
        print('Client> ' + msgClient)
        if msgClient.upper() == "FIN" or msgClient == "":
            break
        msgServeur = input("Serveur> ")
        connection.send(msgServeur.encode("Utf8"))
        msgClient = connection.recv(1024).decode("Utf8")

    # Fermeture de la connexion
    connection.send("fin".encode("Utf8"))
    print('Connexion interrompue.')
    connection.close()

    ch = input("<R>ecommencer <T>erminer ? ")
    if ch.upper() == 'T':
        break
